CREATE DATABASE Employee;

USE Employee;

CREATE TABLE DEPT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(50),
    DLOC VARCHAR(50)
);

CREATE TABLE EMPLOYEE (
    EMPNO INT PRIMARY KEY,
    ENAME VARCHAR(50),
    MGR_NO INT,
    HIREDATE DATE,
    SAL DECIMAL(10, 2),
    DEPTNO INT,
    FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)
);

CREATE TABLE PROJECT (
    PNO INT PRIMARY KEY,
    PLOC VARCHAR(50),
    PNAME VARCHAR(50)
);

CREATE TABLE ASSIGNED_TO (
    EMPNO INT,
    PNO INT,
    JOB_ROLE VARCHAR(50),
    PRIMARY KEY (EMPNO, PNO),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
    FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
);

CREATE TABLE INCENTIVES (
    EMPNO INT,
    INCENTIVE_DATE DATE,
    INCENTIVE_AMOUNT DECIMAL(10, 2),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
);

INSERT INTO DEPT (DEPTNO, DNAME, DLOC) VALUES
(1, 'Sales', 'Bengaluru'),
(2, 'Marketing', 'Hyderabad'),
(3, 'IT', 'Mysuru'),
(4, 'Finance', 'Chennai'),
(5, 'HR', 'Delhi');

INSERT INTO EMPLOYEE (EMPNO, ENAME, MGR_NO, HIREDATE, SAL, DEPTNO) VALUES
(101, 'John', NULL, '2021-01-01', 50000, 1),
(102, 'Mohan', 101, '2020-05-15', 60000, 2),
(103, 'Max', 102, '2019-08-25', 70000, 3),
(104, 'Tim', NULL, '2022-04-10', 55000, 4),
(105, 'Eve', 104, '2021-11-20', 58000, 5);

INSERT INTO PROJECT (PNO, PLOC, PNAME) VALUES
(201, 'Bengaluru', 'Project A'),
(202, 'Hyderabad', 'Project B'),
(203, 'Mysuru', 'Project C'),
(204, 'Chennai', 'Project D'),
(205, 'Delhi', 'Project E');

INSERT INTO ASSIGNED_TO (EMPNO, PNO, JOB_ROLE) VALUES
(101, 201, 'Developer'),
(102, 202, 'Manager'),
(103, 203, 'Analyst'),
(104, 204, 'Consultant'),
(105, 205, 'HR Specialist');

INSERT INTO INCENTIVES (EMPNO, INCENTIVE_DATE, INCENTIVE_AMOUNT) VALUES
(101, '2023-03-01', 2000),
(102, '2023-04-15', 1500),
(103, '2023-05-20', 3000),
(104, '2023-06-10', 2500),
(105, '2023-07-25', 1000);

SELECT DISTINCT EMPNO
FROM ASSIGNED_TO
JOIN PROJECT ON ASSIGNED_TO.PNO = PROJECT.PNO
WHERE PROJECT.PLOC IN ('Bengaluru', 'Hyderabad', 'Mysuru');

SELECT EMPNO
FROM EMPLOYEE
WHERE EMPNO NOT IN (SELECT EMPNO FROM INCENTIVES);

SELECT E.EMPNO, E.ENAME, E.DEPTNO, A.JOB_ROLE, D.DLOC AS DEPT_LOCATION, P.PLOC AS PROJECT_LOCATION
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
JOIN ASSIGNED_TO A ON E.EMPNO = A.EMPNO
JOIN PROJECT P ON A.PNO = P.PNO
WHERE D.DLOC = P.PLOC;

SELECT E2.ENAME AS Manager_name,
COUNT(E1.EMPNO) AS Employee_Count
FROM EMPLOYEE E1
INNER JOIN EMPLOYEE E2 ON E1.MGR_NO = E2.EMPNO
GROUP BY E1.MGR_NO
ORDER BY EmployeeCount DESC
LIMIT 1;


SELECT E2.ENAME AS ManagerName, E2.SAL AS ManagerSalary
FROM EMPLOYEE E2
JOIN (
    SELECT MGR_NO, AVG(SAL) AS AvgEmployeeSalary
    FROM EMPLOYEE
    WHERE MGR_NO IS NOT NULL
    GROUP BY MGR_NO
) AS Subquery ON E2.EMPNO = Subquery.MGR_NO
WHERE E2.SAL > Subquery.AvgEmployeeSalary;


SELECT E.ENAME AS SecondLevelManager, D.DNAME AS Department
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
WHERE E.MGR_NO IN (SELECT EMPNO FROM EMPLOYEE WHERE MGR_NO IS NULL);


SELECT E.EMPNO, E.ENAME, E.MGR_NO, E.HIREDATE, E.SAL, E.DEPTNO, I.INCENTIVE_DATE, I.INCENTIVE_AMOUNT
FROM EMPLOYEE E
JOIN INCENTIVES I ON E.EMPNO = I.EMPNO
WHERE I.INCENTIVE_DATE BETWEEN '2019-01-01' AND '2019-01-31'
ORDER BY I.INCENTIVE_AMOUNT DESC
LIMIT 1 OFFSET 1;


SELECT EMPNO, ENAME, DEPTNO
FROM EMPLOYEE
WHERE DEPTNO = (SELECT DEPTNO FROM EMPLOYEE AS MGR WHERE MGR.EMPNO = EMPLOYEE.MGR_NO); 

-- from here

SELECT E.EMPNO, E.ENAME, A.PNO, P.PNAME AS PROJECT_NAME, P.PLOC AS PROJECT_LOCATION
FROM EMPLOYEE E
LEFT JOIN ASSIGNED_TO A ON E.EMPNO = A.EMPNO
LEFT JOIN PROJECT P ON A.PNO = P.PNO;

SELECT E.EMPNO, E.ENAME, SUM(I.INCENTIVE_AMOUNT) AS TOTAL_INCENTIVE
FROM EMPLOYEE E
JOIN INCENTIVES I ON E.EMPNO = I.EMPNO
GROUP BY E.EMPNO, E.ENAME;

SELECT P.PNAME, P.PLOC
FROM PROJECT P
JOIN ASSIGNED_TO A ON P.PNO = A.PNO
WHERE A.JOB_ROLE = 'Manager';

SELECT D.DNAME AS DEPARTMENT_NAME, COUNT(E.EMPNO) AS EMPLOYEE_COUNT
FROM DEPT D
LEFT JOIN EMPLOYEE E ON D.DEPTNO = E.DEPTNO
GROUP BY D.DNAME;

SELECT E.EMPNO, E.ENAME
FROM EMPLOYEE E
LEFT JOIN ASSIGNED_TO A ON E.EMPNO = A.EMPNO
WHERE A.PNO IS NULL;


SELECT E.EMPNO, E.ENAME, D.DNAME AS DEPARTMENT_NAME, D.DLOC AS DEPARTMENT_LOCATION
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO;


SELECT E.EMPNO, E.ENAME, E.DEPTNO, E.HIREDATE, E.SAL, E.MGR_NO
FROM EMPLOYEE E
WHERE E.MGR_NO = 101;


SELECT P.PNAME, P.PLOC, COUNT(A.EMPNO) AS EMPLOYEE_COUNT
FROM PROJECT P
JOIN ASSIGNED_TO A ON P.PNO = A.PNO
GROUP BY P.PNAME, P.PLOC;


SELECT E.EMPNO, E.ENAME, D.DNAME AS DEPARTMENT_NAME, D.DLOC AS DEPARTMENT_LOCATION
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
WHERE E.MGR_NO IN (SELECT MGR_NO FROM EMPLOYEE WHERE EMPNO = E.MGR_NO);


SELECT E.EMPNO, E.ENAME, D.DNAME AS DEPARTMENT_NAME, D.DLOC AS DEPARTMENT_LOCATION
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
WHERE E.MGR_NO IN (SELECT MGR_NO FROM EMPLOYEE WHERE EMPNO = E.MGR_NO);


SELECT E.EMPNO, E.ENAME, COUNT(I.INCENTIVE_DATE) AS INCENTIVE_COUNT, SUM(I.INCENTIVE_AMOUNT) AS TOTAL_INCENTIVE
FROM EMPLOYEE E
LEFT JOIN INCENTIVES I ON E.EMPNO = I.EMPNO
GROUP BY E.EMPNO, E.ENAME;


SELECT E.EMPNO, E.ENAME, A.JOB_ROLE, P.PNAME AS PROJECT_NAME
FROM EMPLOYEE E
JOIN ASSIGNED_TO A ON E.EMPNO = A.EMPNO
JOIN PROJECT P ON A.PNO = P.PNO
WHERE A.JOB_ROLE = 'Developer';


SELECT D.DNAME AS DEPARTMENT_NAME, AVG(E.SAL) AS AVERAGE_SALARY
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
GROUP BY D.DNAME;






